<script>
    let defaultImage;

    const feedList1 = [
        'https://daily-philosophy.com/index.xml',
        'https://modernstoicism.com/feed/',
        'https://kill-the-newsletter.com/feeds/4p8oscbtrr8qq3zukx5v.xml',
        'https://github.com/GrumpleTurt/RSS-Feed/raw/main/daily_feed.xml'
    ];

    const feedList2 = [
        'https://kosmofoto.com/category/news/feed/',
        'https://www.youtube.com/feeds/videos.xml?channel_id=UCx4MHIcTdwdcmJ5accSDlPA',
        'https://www.youtube.com/feeds/videos.xml?channel_id=UCLcKQhTO6i0oq10S234vWyA',
        'https://leica-camera.blog/feed/',
        'http://www.fujirumors.com/feed/',
        'https://filmphotographyproject.com/feed/'
    ];

    // Function to fetch and display text from a file
    async function fetchTextFile() {
        try {
            const response = await fetch('https://github.com/GrumpleTurt/RSS-Feed/raw/main/Enchiridion.txt');
            const text = await response.text();
            
            const feedContainer = document.getElementById('feed');
            feedContainer.innerHTML = ''; // Clear previous content

            const article = document.createElement('div');
            article.className = 'feed-item';
            article.style.maxWidth = '80%'; // Adjust max width for readability
            article.style.margin = '20px auto';
            article.innerHTML = `
                <div class="feed-content">
                    <pre style="white-space: pre-wrap; font-size: 1rem;">${text}</pre>
                </div>
            `;
            feedContainer.appendChild(article);
        } catch (error) {
            console.error('Error fetching text file:', error);
        }
    }

    async function fetchRSS(feeds) {
        let allItems = [];

        for (const feed of feeds) {
            try {
                const response = await fetch(`https://api.rss2json.com/v1/api.json?rss_url=${feed}`);
                const data = await response.json();

                if (data.items && data.items.length > 0) {
                    data.items.forEach(item => {
                        let description = item.description.length > 150 ? item.description.substring(0, 150) + '...' : item.description;

                        let imageUrl = item.thumbnail || 
                                       (item.content && item.content.match(/<img[^>]+src="([^">]+)"/)?.[1]) ||
                                       (item['media:content'] && item['media:content'].url) ||
                                       (item['content:encoded'] && item['content:encoded'].match(/<img[^>]+src="([^">]+)"/)?.[1]) ||
                                       defaultImage;

                        allItems.push({
                            source: data.feed.title,
                            title: item.title,
                            link: item.link,
                            description: description.replace(/<p>The post.*<\/p>/, ''),
                            pubDate: new Date(item.pubDate),
                            image: imageUrl
                        });
                    });
                }
            } catch (error) {
                console.error('Error fetching RSS feed:', error);
            }
        }

        allItems.sort((a, b) => b.pubDate - a.pubDate);

        const feedContainer = document.getElementById('feed');
        feedContainer.innerHTML = '';

        allItems.forEach(item => {
            const article = document.createElement('div');
            article.className = 'feed-item';

            article.innerHTML = `
                <img src="${item.image}" alt="Article Image" onerror="this.src='${defaultImage}'">
                <div class="feed-content">
                    <div class="feed-source">${item.source}</div>
                    <div class="feed-date">${item.pubDate.toDateString()}</div>
                    <h3><a href="${item.link}" target="_blank">${item.title}</a></h3>
                    <p>${item.description}</p>
                </div>
            `;
            feedContainer.appendChild(article);
        });
    }

    document.getElementById('button1').addEventListener('click', () => {
        defaultImage = 'https://github.com/GrumpleTurt/RSS-Feed/blob/main/Grumple-Turt-Book.png?raw=true';
        fetchRSS(feedList1);
    });

    document.getElementById('button2').addEventListener('click', () => {
        defaultImage = 'https://github.com/GrumpleTurt/RSS-Feed/blob/main/Grumple%20Turt%20Photography.png?raw=true';
        fetchRSS(feedList2);
    });

    document.getElementById('button3').addEventListener('click', () => {
        fetchTextFile(); // Fetch and display text document
    });

    // Load feedList1 by default when page loads
    defaultImage = 'https://github.com/GrumpleTurt/RSS-Feed/blob/main/Grumple-Turt-Book.png?raw=true';
    fetchRSS(feedList1);
</script>
