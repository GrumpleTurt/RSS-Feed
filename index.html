<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grumple Turt RSS</title>
    <style>
        /* Styles remain the same as previously defined */
    </style>
</head>
<body>

    <div class="header-container">
        <a href="javascript:location.reload();">
            <img src="https://github.com/GrumpleTurt/RSS-Feed/raw/main/Grumple%20Turt%20Photography.png" alt="Grumple Turt Logo">
        </a>
    </div>

    <div id="feed" class="feed"></div>

    <script>
        async function fetchRSS() {
            const defaultImage = 'https://github.com/GrumpleTurt/RSS-Feed/raw/main/Grumple%20Turt%20Photography.png';

            const feeds = [
                'https://filmphotographyproject.com/feed/',
                'http://www.fujirumors.com/feed/',
                'https://leica-camera.blog/feed/',
                'https://daily-philosophy.com/index.xml'
            ];

            let allItems = [];

            for (const feed of feeds) {
                try {
                    const response = await fetch(`https://api.rss2json.com/v1/api.json?rss_url=${feed}`);
                    const data = await response.json();

                    if (data.items && data.items.length > 0) {
                        for (let item of data.items) {
                            let description = item.description.length > 150 ? item.description.substring(0, 150) + '...' : item.description;

                            let image = item.thumbnail; // Start with thumbnail if available

                            // Special handling for Daily Philosophy feed
                            if (feed === 'https://daily-philosophy.com/index.xml') {
                                try {
                                    const postResponse = await fetch(item.link);
                                    const postText = await postResponse.text();
                                    const ogImageMatch = postText.match(/<meta property="og:image" content="([^"]+)"/);
                                    if (ogImageMatch && ogImageMatch[1]) {
                                        image = ogImageMatch[1];
                                    }
                                } catch (error) {
                                    console.error('Error fetching post image:', error);
                                }
                            }

                            // Fall back to default image if no image found
                            if (!image) {
                                image = defaultImage;
                            }

                            allItems.push({
                                source: data.feed.title,
                                title: item.title,
                                link: item.link,
                                description: description.replace(/<p>The post.*<\/p>/, ''),
                                pubDate: new Date(item.pubDate),
                                image: image
                            });
                        }
                    }
                } catch (error) {
                    console.error('Error fetching RSS feed:', error);
                }
            }

            allItems.sort((a, b) => b.pubDate - a.pubDate);

            const feedContainer = document.getElementById('feed');
            allItems.forEach(item => {
                const article = document.createElement('div');
                article.className = 'feed-item';

                article.innerHTML = `
                    <img src="${item.image}" alt="Article Image">
                    <div class="feed-content">
                        <div class="feed-source">${item.source}</div>
                        <div class="feed-date">${item.pubDate.toDateString()}</div>
                        <h3><a href="${item.link}" target="_blank">${item.title}</a></h3>
                        <p>${item.description}</p>
                    </div>
                `;
                feedContainer.appendChild(article);
            });
        }

        fetchRSS();
    </script>

</body>
</html>
